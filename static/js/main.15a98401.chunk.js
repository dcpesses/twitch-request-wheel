(this["webpackJsonptwitch-bot"]=this["webpackJsonptwitch-bot"]||[]).push([[0],{34:function(e,t){},45:function(e,t,a){},46:function(e,t,a){},50:function(e,t,a){},58:function(e,t){},80:function(e,t,a){},81:function(e,t,a){"use strict";a.r(t);var s=a(2),n=a.n(s),c=a(36),i=a.n(c),r=a(21),o=(a(45),a(9)),u=a(10),h=a(12),l=a(11),d=(a(46),a(19)),m=a.n(d),p=a(4),b=a(25),j=a(17),f=a(16),g=a(37),x=a(40),O=a(24),v=1,y=2,k=3,w=function(){function e(t){var a=this;Object(o.a)(this,e),this.updateLastMessageTime=function(e){a.lastMessageTimes=Object(p.a)(Object(p.a)({},a.lastMessageTimes),{},Object(f.a)({},e,Date.now()))},this.minsSinceLastChatMessage=function(e){return Math.floor((Date.now()-a.lastMessageTimes[e])/6e4)},this.getChatters=function(){return O("https://thingproxy.freeboard.io/fetch/https://tmi.twitch.tv/group/user/".concat(a.channel,"/chatters")).then((function(e){return e.json()})).then((function(e){return e&&e.chatters?[].concat(Object(j.a)(e.chatters.moderators),Object(j.a)(e.chatters.viewers),Object(j.a)(e.chatters.staff),Object(j.a)(e.chatters.admins),Object(j.a)(e.chatters.global_mods)):null})).catch((function(e){return null}))},this.channel=t,this.lastMessageTimes={},this.getStatusPromise=this.getStatusPromise.bind(this)}return Object(u.a)(e,[{key:"getStatusPromise",value:function(){var e=Object(b.a)(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==this.channel){e.next=2;break}return e.abrupt("return",v);case 2:if(!(this.lastMessageTimes[t]&&this.minsSinceLastChatMessage(t)<10)){e.next=4;break}return e.abrupt("return",v);case 4:return e.abrupt("return",this.getChatters().then((function(e){return e&&e.includes(t)?y:k})));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),G=(a(50),a.p+"static/media/lock.6857c469.svg"),C=a(3),M=function(e){Object(h.a)(a,e);var t=Object(l.a)(a);function a(e){var s;return Object(o.a)(this,a),(s=t.call(this,e)).getFormattedTimeDiff=function(e){var t="minute",a=Math.floor((Date.now()-e)/6e4);return 0===a?"just now":(a>=60&&(t="hour",(a=Math.floor(a/60))>=24&&(t="day",a=Math.floor(a/24))),"".concat(a," ").concat(t).concat(1===a?"":"s"," ago"))},s.updateStatus=function(){s.props.getActivity(s.props.metadata.username).then((function(e){s.setState((function(){return Object(p.a)(Object(p.a)({},s.state),{},{timeDiff:s.getFormattedTimeDiff(s.props.metadata.time),activityStatus:e})}))}))},s.delete=function(e){s.props.onDelete(s.props.msg)},s.toggleLock=function(){s.props.toggleLock(s.props.msg)},s.getTooltipContents=function(){var e="";switch(s.state.activityStatus){case v:e="active";break;case y:e="idle";break;case k:e="disconnected"}return'\n      <div class="tooltip">\n        <p class="tooltipText">Requested '.concat(s.state.timeDiff," by ").concat(s.props.metadata.username,'</p>\n        <div class="status ').concat(e,'" />\n      </div>')},s.state={timeDiff:0,activityStatus:null},s}return Object(u.a)(a,[{key:"render",value:function(){var e=this.props.metadata.locked?"1":"0.2",t=this.props.metadata.chosen?"chosen":"pending";return Object(C.jsxs)("div",{children:[Object(C.jsx)(x.a,{effect:"solid",place:"right"}),Object(C.jsx)("div",{id:"baseDiv",className:t,"data-tip":this.getTooltipContents(),"data-html":!0,onMouseEnter:this.updateStatus,children:Object(C.jsxs)("div",{style:{margin:"0px 15px 7px",padding:"4px",fontSize:"16px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[this.props.msg,Object(C.jsxs)("div",{style:{display:"flex"},children:[Object(C.jsx)("img",{src:G,alt:"lock",style:{width:"16px",opacity:e,paddingRight:"8px"},className:"lock",onClick:this.toggleLock}),Object(C.jsx)("button",{type:"button",className:"deleteButton",onClick:this.delete,children:"X"})]})]})})]})}}]),a}(s.Component),S=a(32),N=a(27),T=a.n(N),q=a.p+"static/media/JackboxGames.c3767761.yaml",_=a(24),D=a(56),I="!request",L=function(e){Object(h.a)(a,e);var t=Object(l.a)(a);function a(e){var s;return Object(o.a)(this,a),(s=t.call(this,e)).checkForGameCommand=function(e,t){if("!gamelist"===e&&s.sendMessage("/me @".concat(t,", click here for a list of valid Jackbox games: ").concat("https://dcpesses.github.io/twitch-request-wheel/#","/gamelist")),e.startsWith(I)){var a=e.replace(I,"").trim().toLowerCase();for(var n in s.state.validGames)for(var c=s.state.validGames[n],i=0,r=Object.entries(c);i<r.length;i++){var o=Object(S.a)(r[i],2),u=o[0];if(o[1].includes(a))return"".concat(u," (").concat(n,")")}return s.sendMessage("/me @".concat(t,", ").concat(a," could not be found in the list of valid Jackbox games. Click here for a list of valid games: ").concat("https://dcpesses.github.io/twitch-request-wheel/#","/gamelist")),null}},s.onMessage=function(e,t,a,n){if(!n)if(s.props.onMessage(a,t.username,t),"!nextgame"!==a.trim()){var c=s.checkForGameCommand(a.trim(),t.username);if(c)if(s.props.messages[c])s.sendMessage("/me @".concat(t.username,", ").concat(c," has already been requested!"));else{for(var i=null,r=0,o=Object.entries(s.props.messages);r<o.length;r++){var u=Object(S.a)(o[r],2),h=u[0];if(u[1].username===t.username){i=h;break}}i?s.props.channel===t.username?s.sendMessage("/me @".concat(t.username,", ").concat(c," has been added to the request queue. Your previous game request(s) weren't deleted, since you have special broadcaster privilege :P")):(s.props.onDelete(i),s.sendMessage("/me @".concat(t.username,", your previous request of ").concat(i," has been replaced with ").concat(c,"."))):s.sendMessage("/me @".concat(t.username,", ").concat(c," has been added to the request queue.")),s.props.addGame(c,t.username)}}else s.props.nextGame?s.sendMessage("/me @".concat(t.username,", unless someone requested a different one with channel points, the next game up is ").concat(s.props.nextGame,"!")):s.sendMessage("/me @".concat(t.username,", the next game hasn't been decided yet (unless someone requested one with channel points)!"))},s.sendMessage=function(e){s.state.client.say(s.props.channel,e)},s.state={client:null,validGames:[]},s}return Object(u.a)(a,[{key:"componentDidMount",value:function(e){var t=this,a=new D.client({identity:{username:this.props.channel,password:this.props.access_token},channels:[this.props.channel]});a.on("message",this.onMessage),a.connect(),_(q).then((function(e){return e.text()})).then((function(e){t.setState((function(t){return Object(p.a)(Object(p.a)({},t),{},{client:a,validGames:T.a.parse(e)})}))}))}},{key:"render",value:function(){return null}}]),a}(s.Component),P=function(e){Object(h.a)(a,e);var t=Object(l.a)(a);function a(e){var s;return Object(o.a)(this,a),(s=t.call(this,e)).printGame=function(e){return e===s.props.nextGameIdx?Object(C.jsx)("b",{style:{color:"aquamarine"},children:s.props.history[e]}):s.props.history[e]},s.state={index:0},s}return Object(u.a)(a,[{key:"render",value:function(){var e=this;return Object(C.jsxs)("div",{style:{marginLeft:"12px",width:"33%",textTransform:"capitalize"},children:[Object(C.jsx)("div",{style:{backgroundColor:"darkslategrey",borderRadius:"5px",marginTop:0,padding:"1px",marginBottom:"10px"},children:Object(C.jsxs)("p",{style:{fontSize:"14px",fontWeight:"700",height:"70px",padding:"8px"},children:[" Up Next:",this.props.history.length>this.props.nextGameIdx?Object(C.jsx)("p",{children:this.props.history[this.props.nextGameIdx]}):Object(C.jsx)("p",{children:"not yet decided"})]})}),Object(C.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[Object(C.jsx)("button",{onClick:this.props.moveNextGameBack,style:{backgroundColor:"darkcyan",borderRadius:"5px",marginTop:0,width:"50%",marginBottom:"20px",marginRight:"5px"},children:" \ud83e\udca0 "}),Object(C.jsx)("button",{onClick:this.props.moveNextGameFwd,style:{backgroundColor:"darkcyan",borderRadius:"5px",marginTop:0,width:"50%",marginBottom:"20px",marginLeft:"5px"},children:" \ud83e\udca1 "})]}),Object(C.jsxs)("div",{style:{backgroundColor:"darkslategrey",borderRadius:"5px",marginTop:0,padding:"5px"},children:[Object(C.jsx)("p",{style:{fontSize:"14px",fontWeight:"700"},children:" History "}),Object(C.jsxs)("p",{style:{fontSize:"12px"},children:[this.props.history.map((function(t,a){return Object(C.jsx)("li",{children:e.printGame(a)},a)})),0===this.props.history.length&&Object(C.jsx)("li",{children:"No games yet"},"0")]})]})]})}}]),a}(s.Component),B=a(72),F=function(e){Object(h.a)(a,e);var t=Object(l.a)(a);function a(e){var s;return Object(o.a)(this,a),(s=t.call(this,e)).moveNextGameFwd=function(){s.state.nextGameIdx!==s.state.history.length&&s.setState((function(e){return Object(p.a)(Object(p.a)({},s.state),{},{nextGameIdx:e.nextGameIdx+1})}))},s.moveNextGameBack=function(){s.state.nextGameIdx<=0||s.setState((function(e){return Object(p.a)(Object(p.a)({},s.state),{},{nextGameIdx:e.nextGameIdx-1})}))},s.addGame=function(e,t){s.setState((function(a){return Object(p.a)(Object(p.a)({},a),{},{messages:Object(p.a)(Object(p.a)({},s.state.messages),{},Object(f.a)({},e,{username:t,time:Date.now(),locked:!1,chosen:!1})),counter:s.state.counter+1})}))},s.toggleLock=function(e){var t=Object(p.a)({},s.state.messages[e]);t.locked=!t.locked,s.setState((function(){return Object(p.a)(Object(p.a)({},s.state),{},{messages:Object(p.a)(Object(p.a)({},s.state.messages),{},Object(f.a)({},e,t))})}))},s.onGameChosen=function(e){if(0!==Object.keys(s.state.messages).length){var t=s.state.messages[e].username;s.chatActivity.getStatusPromise(t).then((function(a){var n="";switch(a){case k:n="".concat(e," just won the spin, but it doesn't seem like @").concat(t," is still around. Hope someone else wants to play!");break;case v:n="@".concat(t,", good news - ").concat(e," just won the spin!");break;case y:default:n+="@".concat(t,", good news - ").concat(e," just won the spin! (I hope you're still around!)")}s.messageHandler.sendMessage(n)})),s.setState((function(t){return Object(p.a)(Object(p.a)({},t),{},{history:[].concat(Object(j.a)(s.state.history),[e]),messages:Object(p.a)(Object(p.a)({},t.messages),{},Object(f.a)({},e,Object(p.a)(Object(p.a)({},t.messages[e]),{},{chosen:!0})))})})),s.state.messages[e].locked||setTimeout((function(){s.removeGame(e,!0)}),2500)}},s.removeGame=function(e){var t=Object(p.a)({},s.state.messages);delete t[e],s.setState((function(e){return Object(p.a)(Object(p.a)({},e),{},{messages:t,counter:s.state.counter+1})}))},s.onMessage=function(e,t,a){s.chatActivity.updateLastMessageTime(t)},s.chatActivity=new w(s.props.channel),s.state={messages:{},colors:B({count:99,luminosity:"light",hue:"blue"}),counter:0,history:[],nextGameIdx:0},s}return Object(u.a)(a,[{key:"render",value:function(){var e=this,t=Object.keys(this.state.messages);return Object(C.jsxs)("div",{style:{display:"flex"},children:[Object(C.jsx)(L,{addGame:this.addGame,messages:this.state.messages,channel:this.props.channel,access_token:this.props.access_token,onMessage:this.onMessage,onDelete:this.removeGame,nextGame:this.state.history[this.state.nextGameIdx],ref:function(t){return e.messageHandler=t}}),Object(C.jsxs)("column",{width:"50vw",children:[Object(C.jsx)("h2",{style:{marginBottom:"0"},children:"Game Requests"}),Object(C.jsxs)("h4",{style:{fontSize:"20px",color:"yellow",marginTop:"6px",marginBottom:"12px",fontWeight:400},children:['Type e.g. "!request Blather Round" in ',this.props.channel,"'s chat to add"]}),Object(C.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",height:"100%"},children:[Object(C.jsx)(P,{history:this.state.history,nextGameIdx:this.state.nextGameIdx,moveNextGameFwd:this.moveNextGameFwd,moveNextGameBack:this.moveNextGameBack}),Object(C.jsx)("div",{style:{flexGrow:"2",marginLeft:"15px"},children:t.map((function(t,a){return Object(C.jsx)(M,{msg:t,metadata:e.state.messages[t],onDelete:e.removeGame,toggleLock:e.toggleLock.bind(t),getActivity:e.chatActivity.getStatusPromise},a)}))})]})]}),Object(C.jsx)("column",{width:"50vw",style:{textTransform:"capitalize"},children:Object(C.jsx)("div",{style:{fontSize:"16px",overflow:"hidden",width:"600px"},children:Object(C.jsx)(g.a,{segments:t,segColors:this.state.colors,onFinished:this.onGameChosen,isOnlyOnce:!1,size:250,upDuration:100,downDuration:1e3,primaryColor:"white",contrastColor:"black"},this.state.counter)})})]})}}]),a}(s.Component),z=a(6),R=a(38),A=a.n(R),J=a(24),W=function(e){Object(h.a)(a,e);var t=Object(l.a)(a);function a(){var e;return Object(o.a)(this,a),(e=t.call(this)).state={username:"",access_token:"",failed_login:!1},e}return Object(u.a)(a,[{key:"componentDidMount",value:function(){var e=Object(b.a)(m.a.mark((function e(){var t,a=this;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=A.a.parse(this.props.location.search),e.next=3,J("https://id.twitch.tv/oauth2/token?"+new URLSearchParams({grant_type:"authorization_code",code:t.code,client_id:"hhr272o0i2zrh5zlb5ltbydezvhuwl",client_secret:"qs33icmgtreprhq0wdsyudldtk3fbp",redirect_uri:"https://dcpesses.github.io/twitch-request-wheel/#"}),{method:"POST",headers:{Accept:"application/vnd.twitchtv.v5+json"}}).then((function(e){return e.json()})).then((function(e){e.access_token?(a.setState((function(t){return Object(p.a)(Object(p.a)({},t),{},{access_token:e.access_token})})),J("https://api.twitch.tv/helix/users",{headers:{"Client-ID":"hhr272o0i2zrh5zlb5ltbydezvhuwl",Authorization:"Bearer ".concat(e.access_token)}}).then((function(e){return e.json()})).then((function(e){a.setState((function(t){return Object(p.a)(Object(p.a)({},t),{},{username:e.data[0].login})}))}))):a.setState((function(e){return Object(p.a)(Object(p.a)({},e),{},{failed_login:!0})}))}));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return Object(C.jsx)("div",{children:this.state.failed_login&&"/gamelist"!==this.props.location.pathname?Object(C.jsx)(z.a,{to:"/login"}):this.state.username&&Object(C.jsx)(F,{channel:this.state.username,access_token:this.state.access_token})})}}]),a}(s.Component),H=Object(z.f)(W),E=(a(80),a(24)),U=function(e){var t=Object.keys(e.metadata);return Object(C.jsxs)("div",{className:"partyPackCard",children:[Object(C.jsxs)("p",{className:"partyPackName",children:[e.partyPackName," "]}),t.map((function(t,a){return Object(C.jsx)(X,{gameName:t,possibleMatches:e.metadata[t]},a)}))]})},X=function(e){return console.log(e.possibleMatches),Object(C.jsxs)("div",{children:[Object(C.jsxs)("p",{className:"gameName",children:[e.gameName," "]}),e.possibleMatches.map((function(e,t){return Object(C.jsxs)("li",{className:"possibleGameMatch",children:["!request ",e]})}))]})},Y=function(e){Object(h.a)(a,e);var t=Object(l.a)(a);function a(e){var s;return Object(o.a)(this,a),(s=t.call(this,e)).state={validGames:[]},s}return Object(u.a)(a,[{key:"componentDidMount",value:function(e){var t=this;E(q).then((function(e){return e.text()})).then((function(e){t.setState((function(t){return Object(p.a)(Object(p.a)({},t),{},{validGames:T.a.parse(e)})}))}))}},{key:"render",value:function(){var e=this,t=Object.keys(this.state.validGames);return console.log(t),Object(C.jsx)("div",{className:"partyPackList",children:t.map((function(t,a){return Object(C.jsx)(U,{partyPackName:t,metadata:e.state.validGames[t]},a)}))})}}]),a}(s.Component),K=function(){var e="https://id.twitch.tv/oauth2/authorize?client_id=".concat("hhr272o0i2zrh5zlb5ltbydezvhuwl","&response_type=code&scope=chat:read chat:edit&redirect_uri=").concat("https://dcpesses.github.io/twitch-request-wheel/%23");return Object(C.jsx)("a",{href:e,style:{backgroundColor:"rebeccapurple",borderRadius:"5px",padding:"10px",color:"white"},children:"Log In With Twitch"})},Q=function(e){Object(h.a)(a,e);var t=Object(l.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(u.a)(a,[{key:"render",value:function(){return Object(C.jsx)(r.b,{basename:"/",children:Object(C.jsx)("div",{className:"App",children:Object(C.jsxs)("header",{className:"App-header",children:[Object(C.jsx)(z.b,{exact:!0,path:"/login",children:K()}),Object(C.jsx)(z.b,{path:"/",component:H}),Object(C.jsx)(z.b,{path:"/gamelist",component:Y})]})})})}}]),a}(s.Component),V=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,84)).then((function(t){var a=t.getCLS,s=t.getFID,n=t.getFCP,c=t.getLCP,i=t.getTTFB;a(e),s(e),n(e),c(e),i(e)}))};i.a.render(Object(C.jsx)(n.a.StrictMode,{children:Object(C.jsx)(r.a,{children:Object(C.jsx)(Q,{})})}),document.getElementById("root")),V()}},[[81,1,2]]]);
//# sourceMappingURL=main.15a98401.chunk.js.map