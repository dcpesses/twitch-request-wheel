(this["webpackJsonptwitch-bot"]=this["webpackJsonptwitch-bot"]||[]).push([[0],{35:function(e,t){},46:function(e,t,a){},47:function(e,t,a){},51:function(e,t,a){},59:function(e,t){},73:function(e,t,a){},76:function(e,t,a){},83:function(e,t,a){"use strict";a.r(t);var n=a(3),s=a.n(n),r=a(37),o=a.n(r),i=a(22),c=(a(46),a(8)),l=a(9),u=a(12),d=a(11),h=(a(47),a(20)),m=a.n(h),p=a(27),g=a(4),b=a(18),f=a(14),j=a(17),x=a(38),y=a(39),v=a(26),O=1,k=2,w=3,S=function(){function e(t){var a=this;Object(c.a)(this,e),this.updateLastMessageTime=function(e){a.lastMessageTimes=Object(g.a)(Object(g.a)({},a.lastMessageTimes),{},Object(j.a)({},e,Date.now()))},this.minsSinceLastChatMessage=function(e){return Math.floor((Date.now()-a.lastMessageTimes[e])/6e4)},this.getChatters=function(){return v("https://thingproxy.freeboard.io/fetch/https://tmi.twitch.tv/group/user/".concat(a.channel,"/chatters")).then((function(e){return e.json()})).then((function(e){return e&&e.chatters?[].concat(Object(f.a)(e.chatters.moderators),Object(f.a)(e.chatters.viewers),Object(f.a)(e.chatters.staff),Object(f.a)(e.chatters.admins),Object(f.a)(e.chatters.global_mods)):null})).catch((function(e){return null}))},this.channel=t,this.lastMessageTimes={},this.getStatusPromise=this.getStatusPromise.bind(this)}return Object(l.a)(e,[{key:"getStatusPromise",value:function(){var e=Object(p.a)(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==this.channel){e.next=2;break}return e.abrupt("return",O);case 2:if(!(this.lastMessageTimes[t]&&this.minsSinceLastChatMessage(t)<10)){e.next=4;break}return e.abrupt("return",O);case 4:return e.abrupt("return",this.getChatters().then((function(e){return e&&e.includes(t)?k:w})));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),C=(a(51),a.p+"static/media/lock.6857c469.svg"),G=a(2),M=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).getFormattedTimeDiff=function(e){var t="minute",a=Math.floor((Date.now()-e)/6e4);return 0===a?"just now":(a>=60&&(t="hour",(a=Math.floor(a/60))>=24&&(t="day",a=Math.floor(a/24))),"".concat(a," ").concat(t).concat(1===a?"":"s"," ago"))},n.updateStatus=function(){n.props.getActivity(n.props.metadata.username).then((function(e){n.setState((function(){return Object(g.a)(Object(g.a)({},n.state),{},{timeDiff:n.getFormattedTimeDiff(n.props.metadata.time),activityStatus:e})}))}))},n.delete=function(e){n.props.onDelete(n.props.gameName)},n.toggleLock=function(){n.props.toggleLock(n.props.gameName)},n.getTooltipContents=function(){var e="";switch(n.state.activityStatus){case O:e="active";break;case k:e="idle";break;case w:e="disconnected"}return'\n      <div class="tooltip">\n        <p class="tooltipText">Requested '.concat(n.state.timeDiff," by ").concat(n.props.metadata.username,'</p>\n        <div class="status ').concat(e,'" />\n      </div>')},n.state={timeDiff:0,activityStatus:null},n}return Object(l.a)(a,[{key:"render",value:function(){var e=this.props.metadata.locked?"1":"0.2",t=this.props.metadata.chosen?"chosen":"pending";return Object(G.jsxs)("div",{children:[Object(G.jsx)(y.a,{effect:"solid",place:"right"}),Object(G.jsx)("div",{id:"baseDiv",className:t,"data-tip":this.getTooltipContents(),"data-html":!0,onMouseEnter:this.updateStatus,children:Object(G.jsxs)("div",{style:{margin:"0px 15px 7px",padding:"4px",fontSize:"16px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[this.props.gameName,Object(G.jsxs)("div",{style:{display:"flex"},children:[Object(G.jsx)("img",{src:C,alt:"lock",style:{width:"16px",opacity:e,paddingRight:"8px"},className:"lock",onClick:this.toggleLock}),Object(G.jsx)("button",{type:"button",className:"deleteButton",onClick:this.delete,children:"X"})]})]})})]})}}]),a}(n.Component),N=a(33),P=a(29),_=a.n(P),q=a.p+"static/media/JackboxGames.30f1bd75.yaml",z=a(26),T=a(57),I="!request",L=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).isModOrBroadcaster=function(e){return n.props.channel===e||n.props.modList.includes(e.toLowerCase())},n.checkForMiscCommands=function(e,t){if(e.startsWith("!gamelist")||e.startsWith("!gameslist"))return n.sendMessage("/me @".concat(t,", click here for a list of valid Jackbox games: ").concat("https://dcpesses.github.io/twitch-request-wheel/#","/gamelist")),!0;if("!advancenextgame"===e||"!nextgamefwd"===e||"!nextgameforward"===e)return n.isModOrBroadcaster(t)?(n.props.changeNextGameIdx(1)?n.props.upcomingGames.length>0?(console.log(n.props.upcomingGames),n.sendMessage("/me @".concat(t,", the next game has been changed to ").concat(n.props.upcomingGames[0].name,"."))):n.sendMessage("/me @".concat(t,', the next game has been marked as "TBD".')):n.sendMessage("/me @".concat(t,", there are no more games in the queue to advance to!")),!0):(n.sendMessage("/me @".concat(t,", only channel moderators can use this command.")),!0);if("!nextgameback"===e||"!nextgamebackward"===e)return n.isModOrBroadcaster(t)?(n.props.changeNextGameIdx(-1)?n.sendMessage("/me @".concat(t,", the next game has been changed to ").concat(n.props.upcomingGames[0].name,".")):n.sendMessage("/me @".concat(t,", there are no previous games in the queue to go back to!")),!0):(n.sendMessage("/me @".concat(t,", only channel moderators can use this command.")),!0);if(e.startsWith("!setnextgame")||e.startsWith("!redeemgame")){if(!n.isModOrBroadcaster(t))return n.sendMessage("/me @".concat(t,", only channel moderators can use the ").concat(e.startsWith("!s")?"!setNextGame":"!redeemgame"," command.")),!0;var a=e.replace("!setnextgame","").replace("!redeemgame","").trim();if(""===a)return n.sendMessage("/me @".concat(t,", please specify the game you would like to insert in the queue: for example, ").concat(e.startsWith("!s")?"!setNextGame":"!redeemgame"," TMP 2")),!0;var s=n.findGame(a,t);if(s){var r=n.props.setNextGame(s);0===r?n.sendMessage("/me @".concat(t,", ").concat(s.name," has been inserted as the next game in the queue.")):n.sendMessage("/me @".concat(t,", ").concat(s.name," has been inserted in the queue following ").concat(r," other manual game request").concat(r>1?"s":"","."))}return!0}var o,i;if("!caniplay"===e||"!new"===e)return null===(o=n.props)||void 0===o||o.caniplayHandler(t,{sendConfirmationMsg:"!new"!==e}),!0;if(e.startsWith("!priorityseat")||e.startsWith("!redeemseat")){var c;if(!n.isModOrBroadcaster(t))return n.sendMessage("/me @".concat(t,", only channel moderators can use this command.")),!0;var l=e.replace("!priorityseat","").replace("!redeemseat","").replace("@","").trim();return""===l?(n.sendMessage("/me @".concat(t,", please specify the user who has redeemed a priority seat in the next game: for example, ").concat(e.startsWith("!p")?"!priorityseat":"!redeemseat"," @asukii314")),!0):(null===(c=n.props)||void 0===c||c.caniplayHandler(l,{sendConfirmationMsg:!0,isPrioritySeat:!0}),!0)}if("!leave"===e||"!murd"===e)return null===(i=n.props)||void 0===i||i.playerExitHandler(t),!0;if("!clear"===e){var u;if(n.isModOrBroadcaster(t))null===(u=n.props)||void 0===u||u.clearQueueHandler();return!0}if("!open"===e){var d;if(n.isModOrBroadcaster(t))null===(d=n.props)||void 0===d||d.openQueueHandler();return!0}if("!close"===e){var h;if(n.isModOrBroadcaster(t))null===(h=n.props)||void 0===h||h.closeQueueHandler();return!0}e.startsWith("!redeem")&&n.sendMessage("/me @".concat(t,", this command is no longer supported: please specify either !redeemgame or !redeemseat."))},n.findGame=function(e,t){for(var a in n.state.validGames)for(var s=n.state.validGames[a],r=0,o=Object.entries(s);r<o.length;r++){var i,c=Object(N.a)(o[r],2),l=c[0],u=c[1];if(null===u||void 0===u||null===(i=u.Variants)||void 0===i?void 0:i.includes(e))return Object(g.a)({name:l,longName:"".concat(l," (").concat(a,")"),partyPack:a},u)}return n.sendMessage("/me @".concat(t,", ").concat(e," could not be found in the list of valid Jackbox games. Click here for a list of valid games: ").concat("https://dcpesses.github.io/twitch-request-wheel/#","/gamelist")),null},n.checkForGameCommand=function(e,t){if(e.startsWith(I)){var a=e.replace(I,"").trim();return""===a?(n.sendMessage("/me @".concat(t,", please specify the game you would like to request: for example, !request TMP 2")),null):n.findGame(a,t)}},n.onMessage=function(e,t,a,s){if(!s)if(n.props.onMessage(a,t.username,t),"!nextgame"!==a.trim()){var r=a.trim().toLowerCase();if(!n.checkForMiscCommands(r,t.username)){var o=n.checkForGameCommand(r,t.username);if(o)if(n.props.messages[o.longName])n.sendMessage("/me @".concat(t.username,", ").concat(o.name," has already been requested!"));else{for(var i=null,c=0,l=Object.entries(n.props.messages);c<l.length;c++){var u=Object(N.a)(l[c],2),d=(u[0],u[1]);if(d.username===t.username){i=d.longName;break}}i?n.props.channel===t.username?n.sendMessage("/me @".concat(t.username,", ").concat(o.name," has been added to the request queue. Your previous game request(s) weren't deleted, since you have special broadcaster privilege :P")):(n.props.onDelete(i),n.sendMessage("/me @".concat(t.username,", your previous request of ").concat(i," has been replaced with ").concat(o.name,"."))):n.sendMessage("/me @".concat(t.username,", ").concat(o.name," has been added to the request queue.")),n.props.addGameRequest(o,t.username)}}}else if(n.props.upcomingGames&&n.props.upcomingGames.length>0){var h=n.props.upcomingGames[0].name;if(n.props.upcomingGames.length>1){h+=", followed by ".concat(n.props.upcomingGames[1].name);for(var m=2;m<n.props.upcomingGames.length;m++)h+=" and ".concat(n.props.upcomingGames[m].name)}n.sendMessage("/me @".concat(t.username,", the next game up is ").concat(h,"!"))}else n.sendMessage("/me @".concat(t.username,", the next game hasn't been decided yet - feel free to !request one :)"))},n.sendMessage=function(e){n.state.client.say(n.props.channel,e)},n.state={client:null,validGames:[]},n}return Object(l.a)(a,[{key:"componentDidMount",value:function(e){var t=this,a=new T.client({identity:{username:this.props.channel,password:this.props.access_token},channels:[this.props.channel]});a.on("message",this.onMessage),a.connect(),z(q).then((function(e){return e.text()})).then((function(e){t.setState((function(t){return Object(g.a)(Object(g.a)({},t),{},{client:a,validGames:_.a.parse(e)})}))}))}},{key:"render",value:function(){return null}}]),a}(n.Component),R=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).printGame=function(e){return e===n.props.nextGameIdx?Object(G.jsx)("b",{style:{color:"aquamarine"},children:n.props.history[e].name}):n.props.history[e].name},n.moveNextGameFwd=function(){return n.props.changeNextGameIdx(1)},n.moveNextGameBack=function(){return n.props.changeNextGameIdx(-1)},n.hasNextGame=function(){return n.props.history.length>n.props.nextGameIdx},n.getNextGameName=function(){return n.hasNextGame()?n.props.history[n.props.nextGameIdx].name:"not yet decided"},n.getNextGamePartyPack=function(){return n.hasNextGame()?n.props.history[n.props.nextGameIdx].partyPack:null},n.state={index:0},n}return Object(l.a)(a,[{key:"render",value:function(){var e=this;return Object(G.jsxs)("div",{style:{marginLeft:"12px",width:"game"===this.props.requestMode?"33%":"20%",textTransform:"capitalize"},children:[Object(G.jsx)("div",{style:{backgroundColor:"darkslategrey",borderRadius:"5px",marginTop:0,padding:"1px",marginBottom:"10px"},children:Object(G.jsxs)("p",{style:{fontSize:"14px",fontWeight:"700",padding:"8px"},children:[" Up Next:",Object(G.jsx)("p",{style:{marginBottom:"5px"},children:this.getNextGameName()}),Object(G.jsx)("p",{style:{fontSize:"11px",fontWeight:"400",marginTop:"0px",color:"lightgray"},children:Object(G.jsx)("i",{children:this.getNextGamePartyPack()})}),"game"===this.props.requestMode&&Object(G.jsx)("button",{disabled:!this.hasNextGame(),onClick:this.props.selectPlayers,style:{fontSize:"12px",padding:"5px",backgroundColor:"aquamarine",color:"black",borderRadius:"5px",width:"90%"},children:this.hasNextGame()?Object(G.jsx)("b",{children:"OPEN SEAT REQUESTS"}):Object(G.jsx)("i",{style:{color:"gray"},children:"OPEN SEAT REQUESTS"})})]})}),Object(G.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[Object(G.jsx)("button",{onClick:this.moveNextGameBack,style:{backgroundColor:"darkcyan",borderRadius:"5px",marginTop:0,width:"50%",marginBottom:"20px",marginRight:"5px"},children:" \u21e6 "}),Object(G.jsx)("button",{onClick:this.moveNextGameFwd,style:{backgroundColor:"darkcyan",borderRadius:"5px",marginTop:0,width:"50%",marginBottom:"20px",marginLeft:"5px"},children:" \u21e8 "})]}),Object(G.jsxs)("div",{style:{backgroundColor:"darkslategrey",borderRadius:"5px",marginTop:0,padding:"5px"},children:[Object(G.jsx)("p",{style:{fontSize:"14px",fontWeight:"700"},children:" History "}),Object(G.jsxs)("p",{style:{fontSize:"12px"},children:[this.props.history.map((function(t,a){return Object(G.jsx)("li",{children:e.printGame(a)},a)})),0===this.props.history.length&&Object(G.jsx)("li",{children:"No games yet"},"0")]})]})]})}}]),a}(n.Component),B=(a(73),a.p+"static/media/dice.021a7158.svg"),F=a.p+"static/media/star.de82f684.svg",Q=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).updateColumnSizes=function(){n.setState((function(e){return Object(g.a)(Object(g.a)({},e),{},{columnWidth:n.firstColumn.current.offsetWidth})}))},n.handleNewPlayerRequest=function(e,t){var a,s,r,o,i,c,l,u,d,h=t.isPrioritySeat,m=void 0!==h&&h;if(m){var p=n.state.isQueueOpen?"playing":"interested";return n.updateColumnForUser({username:e,isPrioritySeat:m},p)?"you have been successfully added to the lobby.":"there was an error adding you to the lobby."}return(null===(a=n.state)||void 0===a||null===(s=a.interested)||void 0===s||null===(r=s.map((function(e){return e.username})))||void 0===r?void 0:r.includes(e))||(null===(o=n.state)||void 0===o||null===(i=o.playing)||void 0===i||null===(c=i.map((function(e){return e.username})))||void 0===c?void 0:c.includes(e))||(null===(l=n.state)||void 0===l||null===(u=l.joined)||void 0===u||null===(d=u.map((function(e){return e.username})))||void 0===d?void 0:d.includes(e))?"you are already in the lobby.":n.state.isQueueOpen?n.updateColumnForUser({username:e},"interested")?"you have successfully joined the lobby.":"there was an error adding you to the lobby.":"the queue is currently closed; users have already been selected for this game."},n.updateColumnForUser=function(e,t){return!(!n.state||!n.state[t])&&(n.removeUser(e.username),n.setState((function(a){return Object(g.a)(Object(g.a)({},a),{},Object(j.a)({},t,[].concat(Object(f.a)(a[t]),[e])))})),!0)},n.removeUser=function(e){return n.setState((function(t){return Object(g.a)(Object(g.a)({},t),{},{interested:t.interested.filter((function(t){return t.username!==e})),playing:t.playing.filter((function(t){return t.username!==e})),joined:t.joined.filter((function(t){return t.username!==e}))})}))},n.clearQueue=function(){return n.setState((function(e){return Object(g.a)(Object(g.a)({},e),{},{interested:[],playing:[],joined:[]})}))},n.openQueue=function(){return n.setState((function(e){return Object(g.a)(Object(g.a)({},e),{},{isQueueOpen:!0})}))},n.closeQueue=function(){return n.setState((function(e){return Object(g.a)(Object(g.a)({},e),{},{isQueueOpen:!1})}))},n.playerCount=function(){return n.state.playing.length+n.state.joined.length+(n.state.streamerSeat?1:0)},n.toggleStreamerSeat=function(){n.setState((function(e){return Object(g.a)(Object(g.a)({},e),{},{streamerSeat:!e.streamerSeat})}))},n.canStartGame=function(){var e,t;return(null===(e=n.props.game)||void 0===e?void 0:e["Max players"])>=n.playerCount()&&(null===(t=n.props.game)||void 0===t?void 0:t["Min players"])<=n.playerCount()},n.startGame=function(){n.setState((function(e){return Object(g.a)(Object(g.a)({},e),{},{interested:[],playing:[],joined:[]})})),n.props.startGame()},n.randomizePlayers=function(){for(var e,t,a=Math.min(n.props.game["Max players"]-n.playerCount(),n.state.interested.length),s=[],r=[],o=(n.state.interested,n.state.playing);s.length<a;)e=Math.floor(Math.random()*n.state.interested.length),s.includes(e)||(s.push(e),t=n.state.interested[e].username,r.push(t),o=[].concat(Object(f.a)(o),[n.state.interested[e]]));n.setState((function(e){return Object(g.a)(Object(g.a)({},e),{},{interested:e.interested.filter((function(e){return!r.includes(e.username)})),playing:o})}))},n.renderPlayerCard=function(e,t,a){return Object(G.jsxs)("div",{className:"playerCard",children:[Object(G.jsxs)("div",{style:{display:"flex"},children:[!0===e.isPrioritySeat&&Object(G.jsx)("img",{src:F,alt:"Priority seat redemption",style:{width:"16px",marginLeft:"3px"}}),Object(G.jsx)("p",{className:"playerName",style:{maxWidth:n.state.columnWidth-25},children:e.username})]}),Object(G.jsxs)("div",{className:"changeColButtonsContainer",children:["interested"!==a&&Object(G.jsx)("button",{className:"changeCol",onClick:n.updateColumnForUser.bind(Object(b.a)(n),e,"interested"),children:"Interested"}),"playing"!==a&&Object(G.jsx)("button",{className:"changeCol",onClick:n.updateColumnForUser.bind(Object(b.a)(n),e,"playing"),children:"Playing"}),Object(G.jsx)("button",{className:"changeCol",style:{backgroundColor:"indianred"},onClick:n.removeUser.bind(Object(b.a)(n),e.username),children:"X"})]})]},t)},n.renderStreamerSeatToggle=function(){return Object(G.jsxs)("div",{class:"my-toggle-group",children:[Object(G.jsx)("p",{class:"toggle-label",children:" Reserve seat for streamer? "}),Object(G.jsxs)("div",{class:"my-toggle",children:[Object(G.jsx)("input",{type:"checkbox",defaultChecked:!0,onChange:n.toggleStreamerSeat}),Object(G.jsx)("div",{class:"my-toggle-text no","aria-hidden":"true",children:"No"}),Object(G.jsx)("div",{class:"my-toggle-text yes","aria-hidden":"true",children:"Yes"}),Object(G.jsx)("div",{class:"my-toggle-orb"})]})]})},n.renderPlayerCount=function(){var e,t,a="playerCount";return(null===(e=n.props.game)||void 0===e?void 0:e["Max players"])<n.playerCount()&&(a+=" overlimit"),Object(G.jsxs)("p",{className:a,children:[n.playerCount()," of ",null===(t=n.props.game)||void 0===t?void 0:t["Max players"]," seats claimed"]})},n.firstColumn=s.a.createRef(),n.state={interested:[],playing:[],joined:[],streamerSeat:!1,isQueueOpen:!0},n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){this.updateColumnSizes(),window.addEventListener("resize",this.updateColumnSizes)}},{key:"render",value:function(){var e,t=this,a="startGame";return this.playerCount()<(null===(e=this.props.game)||void 0===e?void 0:e["Min players"])&&(a+=" disabled"),Object(G.jsxs)("div",{className:"playerSelectContainer",children:[Object(G.jsxs)("div",{className:"header",children:[this.renderStreamerSeatToggle(),this.renderPlayerCount(),Object(G.jsx)("button",{className:a,onClick:this.startGame,disabled:!this.canStartGame(),children:"Start Game"})]}),Object(G.jsxs)("div",{className:"playerCardContainer",children:[Object(G.jsxs)("div",{ref:this.firstColumn,className:"playerCardColumn interested",children:[Object(G.jsx)("p",{style:{marginTop:"0",paddingTop:"10px",marginBottom:"10px",fontSize:"16px",fontWeight:"bold"},children:"Interested"}),this.state.interested.filter((function(e){return e.isPrioritySeat})).map((function(e,a){return t.renderPlayerCard(e,a,"interested")})),this.state.interested.filter((function(e){return!e.isPrioritySeat})).map((function(e,a){return t.renderPlayerCard(e,a,"interested")}))]}),Object(G.jsxs)("div",{className:"playerCardColumn playing",children:[Object(G.jsxs)("p",{style:{marginTop:"0",paddingTop:"10px",marginBottom:"10px",fontSize:"16px",fontWeight:"bold"},children:["Playing",Object(G.jsx)("button",{className:"dice",style:{width:"25px",height:"25px",backgroundColor:"greenyellow",borderRadius:"5px",marginLeft:"10px",padding:"0px"},onClick:this.randomizePlayers,children:Object(G.jsx)("img",{src:B,style:{width:"100%",height:"100%"}})})]}),this.state.playing.filter((function(e){return e.isPrioritySeat})).map((function(e,a){return t.renderPlayerCard(e,a,"playing")})),this.state.playing.filter((function(e){return!e.isPrioritySeat})).map((function(e,a){return t.renderPlayerCard(e,a,"playing")}))]}),Object(G.jsxs)("div",{className:"playerCardColumn joined",children:[Object(G.jsx)("p",{style:{marginTop:"0",paddingTop:"10px",marginBottom:"10px",fontSize:"16px",fontWeight:"bold"},children:"Joined"}),this.state.joined.filter((function(e){return e.isPrioritySeat})).map((function(e,a){return t.renderPlayerCard(e,a,"joined")})),this.state.joined.filter((function(e){return!e.isPrioritySeat})).map((function(e,a){return t.renderPlayerCard(e,a,"joined")}))]})]})]})}}]),a}(n.Component),D=a(74),W=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).changeNextGameIdx=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return!(n.state.nextGameIdx+e>n.state.history.length)&&(!(n.state.nextGameIdx+e<0)&&(n.setState((function(t){return Object(g.a)(Object(g.a)({},n.state),{},{nextGameIdx:t.nextGameIdx+e})})),!0))},n.moveNextGameFwd=function(){return n.changeNextGameIdx()},n.moveNextGameBack=function(){return n.changeNextGameIdx(-1)},n.addGameRequest=function(e,t){n.setState((function(a){return Object(g.a)(Object(g.a)({},a),{},{messages:Object(g.a)(Object(g.a)({},n.state.messages),{},Object(j.a)({},e.longName,Object(g.a)(Object(g.a)({},e),{},{username:t,time:Date.now(),locked:!1,chosen:!1}))),counter:n.state.counter+1})}))},n.toggleLock=function(e){var t=Object(g.a)({},n.state.messages[e]);t.locked=!t.locked,n.setState((function(){return Object(g.a)(Object(g.a)({},n.state),{},{messages:Object(g.a)(Object(g.a)({},n.state.messages),{},Object(j.a)({},e,t))})}))},n.setNextGame=function(e){for(var t=n.state.nextGameIdx;t<n.state.history.length&&(null===(a=n.state.history[t])||void 0===a?void 0:a.override);){var a;t++}return n.setState((function(a){return Object(g.a)(Object(g.a)({},a),{},{history:[].concat(Object(f.a)(a.history.slice(0,Math.max(0,t))),[Object(g.a)(Object(g.a)({},e),{},{override:!0})],Object(f.a)(a.history.slice(t)))})})),t-n.state.nextGameIdx},n.addGameToQueue=function(e){n.setState((function(t){return Object(g.a)(Object(g.a)({},t),{},{history:[].concat(Object(f.a)(n.state.history),[Object(g.a)(Object(g.a)({},e),{},{override:!1})]),messages:Object(g.a)(Object(g.a)({},t.messages),{},Object(j.a)({},e.longName,Object(g.a)(Object(g.a)({},t.messages[e.longName]),{},{chosen:!0})))})}))},n.onWheelSpun=function(e){var t,a=null===(t=n.state.messages)||void 0===t?void 0:t[e];if(a){var s=a.username;n.chatActivity.getStatusPromise(s).then((function(e){var t="";switch(e){case w:t="/me ".concat(a.name," just won the spin, but it doesn't seem like @").concat(s," is still around. Hope someone else wants to play!");break;case O:t="/me @".concat(s,", good news - ").concat(a.name," just won the spin!");break;case k:default:t+="/me @".concat(s,", good news - ").concat(a.name," just won the spin! (I hope you're still around!)")}n.messageHandler.sendMessage(t)})),n.addGameToQueue(a),n.state.messages[e].locked||setTimeout((function(){n.removeGame(e,!0)}),2500)}},n.removeGame=function(e){var t=Object(g.a)({},n.state.messages);delete t[e],n.setState((function(e){return Object(g.a)(Object(g.a)({},e),{},{messages:t,counter:n.state.counter+1})}))},n.onMessage=function(e,t,a){n.chatActivity.updateLastMessageTime(t)},n.togglePlayerSelect=function(){n.setState((function(e){return Object(g.a)(Object(g.a)({},e),{},{showPlayerSelectModal:!e.showPlayerSelectModal})}))},n.routePlayRequest=function(e,t){var a,s,r=t.sendConfirmationMsg,o=void 0===r||r,i=t.isPrioritySeat,c=void 0!==i&&i,l=n.state.showPlayerSelectModal?null===(a=n.playerSelector)||void 0===a?void 0:a.handleNewPlayerRequest(e,{isPrioritySeat:c}):"sign-ups are currently closed; try again after this game wraps up!";o&&(null===(s=n.messageHandler)||void 0===s||s.sendMessage("/me @".concat(e,", ").concat(l)))},n.routeLeaveRequest=function(e){var t;null===(t=n.playerSelector)||void 0===t||t.removeUser(e)},n.routeOpenQueueRequest=function(){var e;n.setState((function(e){return Object(g.a)(Object(g.a)({},e),{},{showPlayerSelectModal:!0})})),null===(e=n.playerSelector)||void 0===e||e.openQueue()},n.routeCloseQueueRequest=function(){var e;null===(e=n.playerSelector)||void 0===e||e.closeQueue()},n.routeClearQueueRequest=function(){var e;null===(e=n.playerSelector)||void 0===e||e.clearQueue()},n.startGame=function(){n.state.showPlayerSelectModal=!1,n.moveNextGameFwd()},n.chatActivity=new S(n.props.channel),n.state={messages:{},colors:D({count:99,luminosity:"light",hue:"blue"}),counter:0,history:[],nextGameIdx:0,showPlayerSelectModal:!1},n}return Object(l.a)(a,[{key:"render",value:function(){var e,t,a=this,n=Object.keys(this.state.messages);return"function"===typeof this.props.onLogout&&(t=Object(G.jsx)("button",{style:{position:"absolute",top:0,right:0,backgroundColor:"darkcyan",borderRadius:"5px",marginTop:0,paddingBottom:"5px",paddingTop:"5px",color:"#fff"},onClick:this.props.onLogout,children:"Logout \u27a7"})),Object(G.jsxs)("div",{style:{display:"flex"},children:[Object(G.jsx)(L,{addGameRequest:this.addGameRequest,setNextGame:this.setNextGame,changeNextGameIdx:this.changeNextGameIdx,messages:this.state.messages,channel:this.props.channel,modList:this.props.modList,access_token:this.props.access_token,onMessage:this.onMessage,onDelete:this.removeGame,upcomingGames:this.state.history.slice(this.state.nextGameIdx),caniplayHandler:this.routePlayRequest,playerExitHandler:this.routeLeaveRequest,openQueueHandler:this.routeOpenQueueRequest,closeQueueHandler:this.routeCloseQueueRequest,clearQueueHandler:this.routeClearQueueRequest,ref:function(e){return a.messageHandler=e}}),Object(G.jsxs)("div",{style:{width:this.state.showPlayerSelectModal?"90vw":"45vw"},children:[Object(G.jsx)("h2",{style:{marginBottom:"0"},children:this.state.showPlayerSelectModal?"Seat Requests":"Game Requests"}),!this.state.showPlayerSelectModal&&Object(G.jsxs)("h4",{style:{fontSize:"20px",color:"yellow",marginTop:"6px",marginBottom:"12px",fontWeight:400},children:["Type e.g. ",Object(G.jsx)("b",{children:'"!request Blather Round"'})," in ",this.props.channel,"'s chat to add"]}),this.state.showPlayerSelectModal&&Object(G.jsxs)("h4",{style:{fontSize:"20px",color:"yellow",marginTop:"6px",marginBottom:"12px",fontWeight:400},children:["Type ",Object(G.jsx)("b",{children:"!new"})," in ",this.props.channel,"'s chat if you want to join the next game"]}),Object(G.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",height:"100%"},children:[Object(G.jsx)(R,{history:this.state.history,nextGameIdx:this.state.nextGameIdx,changeNextGameIdx:this.changeNextGameIdx,moveNextGameFwd:this.moveNextGameFwd,moveNextGameBack:this.moveNextGameBack,selectPlayers:this.togglePlayerSelect,requestMode:this.state.showPlayerSelectModal?"seat":"game"}),Object(G.jsxs)("div",{style:{flexGrow:"2",marginLeft:"15px"},children:[this.state.showPlayerSelectModal&&Object(G.jsx)(Q,{game:null===(e=this.state.history)||void 0===e?void 0:e[this.state.nextGameIdx],startGame:this.startGame,ref:function(e){return a.playerSelector=e}}),!this.state.showPlayerSelectModal&&n.map((function(e,t){return Object(G.jsx)(M,{gameName:e,metadata:a.state.messages[e],onDelete:a.removeGame,toggleLock:a.toggleLock.bind(e),getActivity:a.chatActivity.getStatusPromise},t)}))]})]})]}),!this.state.showPlayerSelectModal&&Object(G.jsx)("div",{width:"50vw",style:{textTransform:"capitalize"},children:Object(G.jsx)("div",{style:{fontSize:"16px",overflow:"hidden",width:"600px"},children:Object(G.jsx)(x.a,{segments:n,segColors:this.state.colors,onFinished:this.onWheelSpun,isOnlyOnce:!1,size:250,upDuration:100,downDuration:1e3,primaryColor:"white",contrastColor:"black",fontFamily:"Arial"},this.state.counter)})}),t]})}}]),a}(n.Component),A=(a(76),a(26)),H=function(e){var t=Object.keys(e.metadata);return Object(G.jsxs)("div",{className:"partyPackCard",children:[Object(G.jsxs)("p",{className:"partyPackName",children:[e.partyPackName," "]}),t.map((function(t,a){var n,s;return Object(G.jsx)(U,{gameName:t,possibleMatches:null===(n=e.metadata)||void 0===n||null===(s=n[t])||void 0===s?void 0:s.Variants},a)}))]})},U=function(e){return Object(G.jsxs)("div",{children:[Object(G.jsxs)("p",{className:"gameName",children:[e.gameName," "]}),e.possibleMatches.map((function(e,t){return Object(G.jsxs)("li",{className:"possibleGameMatch",children:["!request ",e]})}))]})},E=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={validGames:[]},n}return Object(l.a)(a,[{key:"componentDidMount",value:function(e){var t=this;A(q).then((function(e){return e.text()})).then((function(e){t.setState((function(t){return Object(g.a)(Object(g.a)({},t),{},{validGames:_.a.parse(e)})}))}))}},{key:"render",value:function(){var e=this,t=Object.keys(this.state.validGames);return Object(G.jsx)("div",{className:"partyPackList",children:t.map((function(t,a){return Object(G.jsx)(H,{partyPackName:t,metadata:e.state.validGames[t]},a)}))})}}]),a}(n.Component),J=a(6),V=a(40),X=a.n(V),Y=a(26),K=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(){var e;return Object(c.a)(this,a),(e=t.call(this)).state={username:localStorage.getItem("__username"),access_token:localStorage.getItem("__access_token"),failed_login:!1},e.getAuth=e.getAuth.bind(Object(b.a)(e)),e.logOut=e.logOut.bind(Object(b.a)(e)),e}return Object(l.a)(a,[{key:"componentDidMount",value:function(){var e=this;if(!this.state.access_token)return this.getAuth();Y("https://api.twitch.tv/helix/users",{headers:{"Client-ID":"hhr272o0i2zrh5zlb5ltbydezvhuwl",Authorization:"Bearer ".concat(this.state.access_token)}}).then((function(e){return e.json()})).then((function(t){return localStorage.setItem("__username",t.data[0].login),Y("https://api.twitch.tv/helix/moderation/moderators?broadcaster_id=".concat(t.data[0].id),{headers:{"Client-ID":"hhr272o0i2zrh5zlb5ltbydezvhuwl",Authorization:"Bearer ".concat(e.state.access_token)}}).then((function(e){return e.json()})).then((function(a){var n=a.data.map((function(e){return e.user_name.toLowerCase()}));e.setState((function(e){return Object(g.a)(Object(g.a)({},e),{},{username:t.data[0].login,modList:n})}))}))})).catch((function(t){return e.getAuth}))}},{key:"logOut",value:function(){localStorage.removeItem("__username"),localStorage.removeItem("__access_token"),Y("https://id.twitch.tv/oauth2/revoke?"+new URLSearchParams({client_id:"hhr272o0i2zrh5zlb5ltbydezvhuwl",token:this.state.access_token,redirect_uri:"https://dcpesses.github.io/twitch-request-wheel/#"}),{method:"POST",headers:{Accept:"application/vnd.twitchtv.v5+json"}}).then((function(){window.location.reload()}))}},{key:"getAuth",value:function(){var e=Object(p.a)(m.a.mark((function e(t){var a,n=this;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t&&console.error(t),localStorage.removeItem("__username"),localStorage.removeItem("__access_token"),a=X.a.parse(this.props.location.search),e.next=6,Y("https://id.twitch.tv/oauth2/token?"+new URLSearchParams({grant_type:"authorization_code",code:a.code,client_id:"hhr272o0i2zrh5zlb5ltbydezvhuwl",client_secret:"qs33icmgtreprhq0wdsyudldtk3fbp",redirect_uri:"https://dcpesses.github.io/twitch-request-wheel/#"}),{method:"POST",headers:{Accept:"application/vnd.twitchtv.v5+json"}}).then((function(e){return e.json()})).then((function(e){e.access_token?(localStorage.setItem("__access_token",e.access_token),n.setState((function(t){return Object(g.a)(Object(g.a)({},t),{},{access_token:e.access_token})})),Y("https://api.twitch.tv/helix/users",{headers:{"Client-ID":"hhr272o0i2zrh5zlb5ltbydezvhuwl",Authorization:"Bearer ".concat(e.access_token)}}).then((function(e){return e.json()})).then((function(e){return localStorage.setItem("__username",e.data[0].login),Y("https://api.twitch.tv/helix/moderation/moderators?broadcaster_id=".concat(e.data[0].id),{headers:{"Client-ID":"hhr272o0i2zrh5zlb5ltbydezvhuwl",Authorization:"Bearer ".concat(n.state.access_token)}}).then((function(e){return e.json()})).then((function(t){var a=t.data.map((function(e){return e.display_name.toLowerCase()}));n.setState((function(t){return Object(g.a)(Object(g.a)({},t),{},{username:e.data[0].login,modList:a})}))}))}))):n.setState((function(e){return Object(g.a)(Object(g.a)({},e),{},{failed_login:!0})}))}));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){return Object(G.jsxs)("div",{children:["/gamelist"===this.props.location.pathname&&Object(G.jsx)(E,{}),this.state.failed_login&&"/gamelist"!==this.props.location.pathname?Object(G.jsx)(J.a,{to:"/login"}):this.state.username&&Object(G.jsx)(W,{channel:this.state.username,modList:this.state.modList,access_token:this.state.access_token,onLogout:this.logOut})]})}}]),a}(n.Component),Z=Object(J.f)(K),$=function(){var e="https://id.twitch.tv/oauth2/authorize?client_id=".concat("hhr272o0i2zrh5zlb5ltbydezvhuwl","&response_type=code&scope=").concat("chat:read chat:edit moderation:read","&redirect_uri=").concat("https%3A%2F%2Fdcpesses.github.io%2Ftwitch-request-wheel%2F%23");return Object(G.jsx)("a",{href:e,style:{backgroundColor:"rebeccapurple",borderRadius:"5px",padding:"10px",color:"white"},children:"Log In With Twitch"})},ee=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){return Object(G.jsx)(i.b,{basename:"/",children:Object(G.jsx)("div",{className:"App",children:Object(G.jsxs)("header",{className:"App-header",children:[Object(G.jsx)(J.b,{exact:!0,path:"/login",children:$()}),Object(G.jsx)(J.b,{path:"/",component:Z}),Object(G.jsx)(J.b,{path:"/gamelist",component:E})]})})})}}]),a}(n.Component),te=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,87)).then((function(t){var a=t.getCLS,n=t.getFID,s=t.getFCP,r=t.getLCP,o=t.getTTFB;a(e),n(e),s(e),r(e),o(e)}))};o.a.render(Object(G.jsx)(s.a.StrictMode,{children:Object(G.jsx)(i.a,{children:Object(G.jsx)(ee,{})})}),document.getElementById("root")),te()}},[[83,1,2]]]);
//# sourceMappingURL=main.ebe6d44d.chunk.js.map